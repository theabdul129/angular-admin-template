<div>
  <div class="flex-wrap flex justify-between">
    <div class="text-2xl font-bold tracking-tight">
      Account Collaborators
    </div>
    <div class="">
      <button (click)="openModal(inviteCollaborator)" mat-flat-button [color]="'primary'">
        <mat-icon [svgIcon]="'heroicons_solid:plus'"></mat-icon>
        <span class="ml-2 mr-1">Invite Collaborator</span>
      </button>
    </div>
  </div>
</div>


<div class="flex flex-auto mt-4">
  <div class="flex flex-col flex-auto overflow-auto sm:overflow-y-auto relative">
    <table class="w-full bg-white" mat-table matSort [dataSource]="dataSource">

      <ng-container matColumnDef="name">
        <th mat-header-cell mat-sort-header *matHeaderCellDef>
          Name
        </th>
        <td mat-cell *matCellDef="let element">
          <span class="pr-6 whitespace-nowrap">
            {{ element.userProfile.firstName +' '+ element.userProfile.surname }}
          </span>
        </td>
      </ng-container>

      <ng-container matColumnDef="email">
        <th mat-header-cell mat-sort-header *matHeaderCellDef>
          Email Address
        </th>
        <td mat-cell *matCellDef="let element">
          <span class="pr-6 whitespace-nowrap">
            {{ element?.userProfile.emailAddress }}
          </span>
        </td>
      </ng-container>

      <ng-container matColumnDef="action">
        <th mat-header-cell mat-sort-header *matHeaderCellDef>
          Actions
        </th>
        <td mat-cell *matCellDef="let element">
          <!-- <button (click)="editCollaborator(element, collaborator)" mat-flat-button [color]="'primary'">
            Edit
          </button> -->
          <button *ngIf="element?.acceptedAt; else invitationHasSent" class="ml-2" [routerLink]="[element?.id]" mat-flat-button [color]="'primary'">
            View
          </button>
          <ng-template #invitationHasSent>
            <div class="inline-block bg-blue-500 text-white rounded-full px-3 py-1 text-sm font-semibold m-0">
              Invitation sent
            </div>
            <!-- <p class="m-0">Invitation sent</p> -->
          </ng-template>
        </td>
      </ng-container>

      <tr class="bg-white shadow" mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
      <tr class="order-row h-16" mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
    <mat-spinner *ngIf="isLoadingObs | async" class="absolute h-full w-full"></mat-spinner>
    <fuse-alert class="m-4" *ngIf="errorMsg || (dataSource && dataSource?.data?.length ==0)" [appearance]="'outline'"
      [type]="'warning'">
      {{errorMsg ? errorMsg : 'No records found'}}
    </fuse-alert>
  </div>
</div>
<mat-paginator (page)="paginate($event)" [length]="totalAccounts" [pageSize]="10" [pageSizeOptions]="[5, 10, 25, 100]"
  aria-label="Select page">
</mat-paginator>

<ng-template #collaborator let-modal>
  <div class="modal-header">
    <h4 class="text-2xl font-bold tracking-tight">Account Collaborators</h4>
    <button (click)="closeModal()" aria-describedby="modal-title" class="close" type="button">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <form [formGroup]="userForm" (ngSubmit)="onSubmit()">
    <div class="modal-body">

      <mat-form-field class="mt-4 fuse-mat-no-subscript w-full">
        <mat-label>First Name*</mat-label>
        <mat-icon matPrefix class="hidden sm:flex icon-size-5" [svgIcon]="'heroicons_solid:office-building'"></mat-icon>
        <input type="number" matInput [formControlName]="'firstName'" [placeholder]="'First Name'">
      </mat-form-field>

      <mat-form-field class="mt-4 fuse-mat-no-subscript w-full">
        <mat-label>Surname*</mat-label>
        <mat-icon matPrefix class="hidden sm:flex icon-size-5" [svgIcon]="'heroicons_solid:office-building'"></mat-icon>
        <input matInput [formControlName]="'surname'" [placeholder]="'Surname'">
      </mat-form-field>


      <mat-form-field class="mt-4 fuse-mat-no-subscript w-full">
        <mat-label>Email Address*</mat-label>
        <mat-icon matPrefix class="hidden sm:flex icon-size-5" [svgIcon]="'heroicons_solid:office-building'"></mat-icon>
        <input matInput [formControlName]="'emailAddress'" [placeholder]="'Email Address'">
      </mat-form-field>

    </div>
    <div class="footer mt-4 ">
      <button [disabled]="userForm.invalid" mat-flat-button [color]="'primary'">
        <mat-icon [svgIcon]="'heroicons_solid:check'"></mat-icon>
        <span class="ml-2 mr-1">Save</span>
      </button>
    </div>
  </form>
</ng-template>

<ng-template #inviteCollaborator let-modal>
  <div class="modal-header">
    <h4 class="text-2xl font-bold tracking-tight my-4">Invite Account Collaborators</h4>
    <button (click)="closeModal()" aria-describedby="modal-title" class="close" type="button">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <form [formGroup]="inviteAccountCollaboratorForm" (ngSubmit)="onInviteSubmit()">
    <div class="modal-body">
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">

      
        <mat-form-field class="fuse-mat-no-subscript w-full">
          <mat-label>First Name*</mat-label>
          <mat-icon matPrefix class="hidden sm:flex icon-size-5" [svgIcon]="'heroicons_solid:user-circle'">
          </mat-icon>
          <input type="text" matInput formControlName="firstName" [placeholder]="'First Title'">
        </mat-form-field>

        <mat-form-field class="fuse-mat-no-subscript w-full">
          <mat-label>Surname*</mat-label>
          <mat-icon matPrefix class="hidden sm:flex icon-size-5" [svgIcon]="'heroicons_solid:user-circle'">
          </mat-icon>
          <input matInput type="text" formControlName="surname" [placeholder]="'surname'">
        </mat-form-field>
 

        <mat-form-field class="fuse-mat-no-subscript w-full">
          <mat-label>Email Address</mat-label>
          <mat-icon matPrefix class="hidden sm:flex icon-size-5" [svgIcon]="'heroicons_solid:mail'">
          </mat-icon>
          <input matInput type="email" formControlName="emailAddress" [placeholder]="'Email Address'">
          <div style="bottom: -25px; left: 0;"
            *ngIf="inviteAccountCollaboratorForm.controls.emailAddress.touched && inviteAccountCollaboratorForm.controls.emailAddress.invalid"
            class="text-red-600 absolute">
            <div *ngIf="inviteAccountCollaboratorForm.controls.emailAddress.errors.required">Email is required</div>
            <div *ngIf="inviteAccountCollaboratorForm.controls.emailAddress.errors.email">Email must be a valid email
              address</div>
          </div>
        </mat-form-field>
      </div>
    </div>
    <div class="footer mt-4">
      <div class="position-relative form-group">
        <button type="submit" [disabled]="inviteAccountCollaboratorForm.invalid || (isLoadingObs | async)" *ngIf="!isAccountCollaboratorSubmited"
          mat-flat-button [color]="'primary'">
          <mat-icon [svgIcon]="'heroicons_solid:check'"></mat-icon>
          <span class="ml-2 mr-1">Save</span>
        </button>
        <button type="button" *ngIf="isAccountCollaboratorSubmited" (click)="closeModal()" mat-flat-button [color]="'primary'">
          <mat-icon [svgIcon]="'heroicons_solid:check'"></mat-icon>
          <span class="ml-2 mr-1">Done</span>
        </button>
      </div>
    </div>
  </form>
</ng-template>